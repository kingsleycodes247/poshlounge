{% load static %}
<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Posh Lounge POS{% endblock %}</title>

    <link rel="stylesheet" href="{% static 'css/tailwind.css' %}">


    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out;
        }

        /* Print styles */
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>

    {% block extra_css %}{% endblock %}
</head>
<body class="h-full">
    <div class="min-h-full">
        <!-- Navigation -->
        {% if user.is_authenticated %}
        <nav class="bg-indigo-600 no-print">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="flex h-16 items-center justify-between">
                    <div class="flex items-center">
                        <!-- Logo/Brand - Clickable to dashboard -->
                        <a href="{% url 'core:dashboard_router' %}" class="flex items-center hover:opacity-80 transition-opacity">
                            <div class="flex-shrink-0">
                                <i data-lucide="utensils" class="h-8 w-8 text-white"></i>
                            </div>
                            <div class="ml-4">
                                <h1 class="text-xl font-bold text-white">Posh Lounge</h1>
                                <p class="text-xs text-indigo-200">{% block page_subtitle %}POS System{% endblock %}</p>
                            </div>
                        </a>

                        <!-- Back Button (optional, shown on sub-pages) -->
                        {% block back_button %}{% endblock %}
                    </div>

                    <div class="flex items-center gap-4">
                        <!-- Clock -->
                        <div class="text-white text-sm">
                            <span id="current-time"></span>
                        </div>

                        <!-- User menu -->
                        <div class="flex items-center gap-3 text-white">
                            <div class="text-right">
                                <p class="text-sm font-medium">{{ user.username }}</p>
                                <p class="text-xs text-indigo-200">{{ user.get_role_display }}</p>
                            </div>
                            <a href="{% url 'core:logout' %}" class="rounded-md bg-indigo-700 px-3 py-2 text-sm font-medium text-white hover:bg-indigo-800 flex items-center gap-1">
                                <i data-lucide="log-out" class="h-4 w-4"></i>
                                Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        {% endif %}

        <!-- Flash messages -->
        {% if messages %}
        <div class="fixed top-20 right-4 z-50 space-y-2 no-print" id="messages-container">
            {% for message in messages %}
            <div class="animate-fadeIn rounded-lg shadow-lg p-4 max-w-md {% if message.tags == 'error' %}bg-red-50 border-l-4 border-red-500{% elif message.tags == 'warning' %}bg-yellow-50 border-l-4 border-yellow-500{% elif message.tags == 'success' %}bg-green-50 border-l-4 border-green-500{% else %}bg-blue-50 border-l-4 border-blue-500{% endif %}">
                <div class="flex items-start gap-3">
                    <i data-lucide="{% if message.tags == 'error' %}alert-circle{% elif message.tags == 'warning' %}alert-triangle{% elif message.tags == 'success' %}check-circle{% else %}info{% endif %}" class="h-5 w-5 {% if message.tags == 'error' %}text-red-600{% elif message.tags == 'warning' %}text-yellow-600{% elif message.tags == 'success' %}text-green-600{% else %}text-blue-600{% endif %}"></i>
                    <p class="flex-1 text-sm {% if message.tags == 'error' %}text-red-800{% elif message.tags == 'warning' %}text-yellow-800{% elif message.tags == 'success' %}text-green-800{% else %}text-blue-800{% endif %}">
                        {{ message }}
                    </p>
                    <button onclick="this.parentElement.parentElement.remove()" class="{% if message.tags == 'error' %}text-red-600{% elif message.tags == 'warning' %}text-yellow-600{% elif message.tags == 'success' %}text-green-600{% else %}text-blue-600{% endif %}">
                        <i data-lucide="x" class="h-4 w-4"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Main content -->
        <main>
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- Initialize Lucide icons -->
    <script>
        // Initialize all Lucide icons
        lucide.createIcons();

        // Update clock every second
        function updateClock() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            const dateStr = now.toLocaleDateString('en-US', {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });

            const clockElement = document.getElementById('current-time');
            if (clockElement) {
                clockElement.innerHTML = `${timeStr}<br><span class="text-xs text-indigo-200">${dateStr}</span>`;
            }
        }

        // Update immediately and then every second
        updateClock();
        setInterval(updateClock, 1000);

        // Auto-dismiss messages after 5 seconds
        setTimeout(() => {
            const container = document.getElementById('messages-container');
            if (container) {
                container.remove();
            }
        }, 5000);

        // Prevent accidental page navigation
        let formSubmitted = false;

        document.addEventListener('submit', () => {
            formSubmitted = true;
        });

        window.addEventListener('beforeunload', (e) => {
            if (!formSubmitted && document.querySelector('form')) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>